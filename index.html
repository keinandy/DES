<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pulso Socio CChC - Compromiso PRO</title>
    <style>
        /* --- Estilos base y de layout --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); color: white; padding: 40px; text-align: center; }
        .header h1 { font-size: 2.2em; margin-bottom: 10px; font-weight: 300; }
        .header p { font-size: 1.1em; opacity: 0.9; line-height: 1.6; }
        .progress-bar { background: #e0e0e0; height: 6px; margin: 0; }
        .progress-fill { background: #4CAF50; height: 100%; width: 0%; transition: width 0.3s ease; }
        .content { padding: 40px; }
        .block { display: none; animation: fadeIn 0.5s ease-in; }
        .block.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .block-header { background: #f8f9fa; padding: 20px; margin: -40px -40px 30px -40px; border-left: 4px solid #4CAF50; }
        .block-title { font-size: 1.4em; color: #333; margin-bottom: 5px; }
        .block-subtitle { color: #666; font-size: 0.95em; }
        .question { margin-bottom: 30px; padding: 15px; border-radius: 10px; border: 2px solid transparent; transition: border-color 0.3s ease; }
        .question-label { font-size: 1.1em; font-weight: 600; color: #333; margin-bottom: 15px; line-height: 1.5; }
        .question-type { font-size: 0.85em; color: #666; font-style: italic; margin-bottom: 10px; }
        .options { margin-bottom: 10px; }
        .option { display: flex; align-items: center; padding: 12px 15px; border: 2px solid #e9ecef; border-radius: 10px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s ease; }
        .option:hover { border-color: #4CAF50; background: #f8fff8; }
        .option.selected { border-color: #4CAF50; background: #e8f5e8; }
        .option input[type="radio"], .option input[type="checkbox"] { margin-right: 12px; width: 18px; height: 18px; }
        
        /* Estilos para el Ranking Interactivo */
        .ranking-wrapper { display: flex; gap: 20px; flex-wrap: wrap; }
        .ranking-column { flex: 1; min-width: 250px; }
        .ranking-column h3 { font-size: 1em; color: #555; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 8px; }
        .ranking-source .option { cursor: pointer; user-select: none; }
        .ranking-source .option.selected { background-color: #f1f3f5; color: #adb5bd; cursor: not-allowed; border-color: #e9ecef; }
        .ranking-source .option.selected:hover { background-color: #f1f3f5; }
        .ranking-target .target-slot { display: flex; align-items: center; padding: 12px 15px; border: 2px dashed #ced4da; border-radius: 10px; margin-bottom: 8px; color: #6c757d; height: 53px; transition: all 0.2s ease; }
        .ranking-target .target-slot.filled { border-style: solid; border-color: #4CAF50; background: #e8f5e8; color: #333; cursor: grab; }
        .ranking-target .target-slot.over { border-color: #28a745; background-color: #d4edda; }
        .ranking-target .target-slot.dragging { opacity: 0.4; }
        .ranking-target .rank-number { font-weight: bold; color: #4CAF50; margin-right: 10px; font-size: 0.9em; }
        .ranking-target .target-content { flex-grow: 1; }
        .ranking-target .remove-btn { background: none; border: none; font-size: 1.2em; cursor: pointer; color: #dc3545; padding: 0 5px; opacity: 0.6; transition: opacity 0.2s; }
        .ranking-target .remove-btn:hover { opacity: 1; }

        /* Estilos para validaci√≥n de errores */
        .question.is-invalid { border-color: #dc3545; }
        .error-message { color: #dc3545; font-size: 0.85em; margin-top: 10px; display: none; }

        /* Estilos para inputs de texto y navegaci√≥n */
        .text-input, .input-field { width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1em; transition: border-color 0.2s ease; }
        .text-input:focus, .input-field:focus { outline: none; border-color: #4CAF50; }
        .navigation { display: flex; justify-content: space-between; align-items: center; margin-top: 40px; padding-top: 30px; border-top: 1px solid #e9ecef; }
        .btn { padding: 12px 30px; border: none; border-radius: 25px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-primary:hover { background: #45a049; transform: translateY(-2px); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-secondary:hover { background: #5a6268; }
        .step-indicator { text-align: center; color: #666; font-size: 0.9em; }
        .completion-message { text-align: center; padding: 60px 40px; }
        .completion-message h2 { color: #4CAF50; font-size: 2em; margin-bottom: 20px; }
        .completion-message p { font-size: 1.1em; color: #666; line-height: 1.6; }

        @media (max-width: 768px) {
            .container { margin: 10px; border-radius: 15px; }
            .header, .content { padding: 20px; }
            .header h1 { font-size: 1.8em; }
            .ranking-wrapper { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Pulso Socio CChC</h1>
            <p>Tu visi√≥n construye el futuro. Ay√∫danos a dise√±ar talleres hechos a la medida de tus necesidades reales.</p>
            <p><strong>Duraci√≥n estimada:</strong> 12-15 minutos | <strong>Confidencial</strong></p>
        </div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="content">
            <!-- BLOQUE 1: NEGOCIO -->
            <div class="block active" id="block1">
                <div class="block-header">
                    <div class="block-title">Bloque 1: Para Entender tu Negocio</div>
                    <div class="block-subtitle">Duraci√≥n estimada: 2 minutos</div>
                </div>

                <div class="question" data-question-id="q1">
                    <div class="question-label">1. ¬øCu√°l de las siguientes opciones describe mejor la actividad principal de tu empresa?</div>
                    <div class="question-type">Pregunta de opci√≥n √∫nica</div>
                    <div class="options">
                         <label class="option"><input type="radio" name="q1" value="constructora"><span>Constructora / Contratista General</span></label>
                         <label class="option"><input type="radio" name="q1" value="inmobiliaria"><span>Inmobiliaria</span></label>
                         <label class="option"><input type="radio" name="q1" value="subcontratista"><span>Subcontratista (ej. el√©ctrico, sanitario, etc.)</span></label>
                         <label class="option"><input type="radio" name="q1" value="proveedor"><span>Proveedor de materiales / equipos</span></label>
                         <label class="option"><input type="radio" name="q1" value="consultoria"><span>Consultor√≠a / Arquitectura / Ingenier√≠a</span></label>
                         <label class="option"><input type="radio" name="q1" value="industrial"><span>Industrial (fabricaci√≥n de insumos)</span></label>
                         <label class="option"><input type="radio" name="q1" value="otro"><span>Otro</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona una opci√≥n.</div>
                </div>

                <div class="question" data-question-id="q2">
                    <div class="question-label">2. ¬øEn qu√© tipo de proyectos se concentra principalmente tu actividad?</div>
                    <div class="question-type">Pregunta de selecci√≥n m√∫ltiple (hasta dos opciones)</div>
                    <div class="options">
                         <label class="option"><input type="checkbox" name="q2" value="vivienda"><span>Vivienda (en altura / casas)</span></label>
                         <label class="option"><input type="checkbox" name="q2" value="vivienda_social"><span>Vivienda social</span></label>
                         <label class="option"><input type="checkbox" name="q2" value="oficinas"><span>Oficinas / Comercial</span></label>
                         <label class="option"><input type="checkbox" name="q2" value="industrial"><span>Industrial / Log√≠stica</span></label>
                         <label class="option"><input type="checkbox" name="q2" value="infraestructura"><span>Infraestructura p√∫blica / Obras civiles</span></label>
                         <label class="option"><input type="checkbox" name="q2" value="salud"><span>Salud / Educaci√≥n</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona hasta dos opciones.</div>
                </div>

                <div class="question" data-question-id="q3">
                    <div class="question-label">3. N√∫mero de centros de trabajo actualmente (considera: oficinas, salas de venta, bodegas, obras en construcci√≥n, f√°bricas, etc.)</div>
                    <div class="question-type">Pregunta de opci√≥n √∫nica</div>
                    <div class="options">
                        <label class="option"><input type="radio" name="q3" value="1"><span>Solamente 1</span></label>
                        <label class="option"><input type="radio" name="q3" value="2-5"><span>Entre 2 y 5</span></label>
                        <label class="option"><input type="radio" name="q3" value="6-10"><span>Entre 6 y 10</span></label>
                        <label class="option"><input type="radio" name="q3" value="10+"><span>M√°s de 10</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona una opci√≥n.</div>
                </div>

                <div class="question" data-question-id="q4a">
                    <div class="question-label">4.a. ¬øAproximadamente cu√°ntos trabajadores DIRECTOS (personal de planta) tiene tu empresa?</div>
                    <div class="question-type">Pregunta de opci√≥n √∫nica</div>
                    <div class="options">
                        <label class="option"><input type="radio" name="q4a" value="micro"><span>Menos de 10 trabajadores</span></label>
                        <label class="option"><input type="radio" name="q4a" value="pequena"><span>Entre 10 y 49 trabajadores</span></label>
                        <label class="option"><input type="radio" name="q4a" value="mediana"><span>Entre 50 y 199 trabajadores</span></label>
                        <label class="option"><input type="radio" name="q4a" value="mediana_grande"><span>Entre 200 y 499 trabajadores</span></label>
                        <label class="option"><input type="radio" name="q4a" value="grande"><span>500 o m√°s trabajadores</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona una opci√≥n.</div>
                </div>

                <div class="question" data-question-id="q4b">
                    <div class="question-label">4.b. Y, en un mes promedio, ¬øcu√°ntos trabajadores INDIRECTOS (subcontratados) moviliza tu empresa?</div>
                    <div class="question-type">Pregunta de opci√≥n √∫nica</div>
                    <div class="options">
                         <label class="option"><input type="radio" name="q4b" value="micro"><span>Menos de 10 trabajadores</span></label>
                         <label class="option"><input type="radio" name="q4b" value="pequena"><span>Entre 10 y 49 trabajadores</span></label>
                         <label class="option"><input type="radio" name="q4b" value="mediana"><span>Entre 50 y 199 trabajadores</span></label>
                         <label class="option"><input type="radio" name="q4b" value="mediana_grande"><span>Entre 200 y 499 trabajadores</span></label>
                         <label class="option"><input type="radio" name="q4b" value="grande"><span>500 o m√°s trabajadores</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona una opci√≥n.</div>
                </div>

                <div class="question" data-question-id="q4c">
                    <div class="question-label">4.c. Proyectando a 6 meses, ¬øc√≥mo esperas que var√≠e tu dotaci√≥n total de trabajadores (directos + indirectos)?</div>
                    <div class="question-type">Pregunta de opci√≥n √∫nica</div>
                    <div class="options">
                         <label class="option"><input type="radio" name="q4c" value="aumenta_sig"><span>Aumentar√° significativamente</span></label>
                         <label class="option"><input type="radio" name="q4c" value="aumenta_lig"><span>Aumentar√° ligeramente</span></label>
                         <label class="option"><input type="radio" name="q4c" value="mantiene"><span>Se mantendr√° similar</span></label>
                         <label class="option"><input type="radio" name="q4c" value="disminuye_lig"><span>Disminuir√° ligeramente</span></label>
                         <label class="option"><input type="radio" name="q4c" value="disminuye_sig"><span>Disminuir√° significativamente</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona una opci√≥n.</div>
                </div>

            </div>

            <!-- BLOQUE 2: DESAF√çOS -->
            <div class="block" id="block2">
                <div class="block-header">
                    <div class="block-title">Bloque 2: Tu D√≠a a D√≠a - Desaf√≠os Operativos</div>
                    <div class="block-subtitle">Duraci√≥n estimada: 3-4 minutos</div>
                </div>

                <div class="question" data-question-id="q5">
                    <div class="question-label">5. De los siguientes desaf√≠os, selecciona los 3 que m√°s complican el d√≠a a d√≠a de tu empresa.</div>
                    <div class="question-type">Pregunta de Ranking (selecciona y luego arrastra para ordenar)</div>
                    <div class="ranking-wrapper" id="ranking_q5">
                        <div class="ranking-column">
                            <h3>Opciones Disponibles</h3>
                            <div class="ranking-source">
                                <div class="option" data-value="precio_materiales">Aumento constante en el precio de materiales</div>
                                <div class="option" data-value="falta_trabajadores">Falta de trabajadores capacitados</div>
                                <div class="option" data-value="flujo_caja">Problemas de flujo de caja y demoras en pagos</div>
                                <div class="option" data-value="clientes_exigentes">Clientes muy exigentes o contratos r√≠gidos</div>
                                <div class="option" data-value="dificultad_subcontratistas">Dificultades con subcontratistas y proveedores</div>
                                <div class="option" data-value="tramites">Tr√°mites y permisos burocr√°ticos</div>
                                <div class="option" data-value="plazos_productividad">Cumplir plazos y mantener productividad</div>
                                <div class="option" data-value="acceso_financiamiento">Acceso a financiamiento</div>
                                <div class="option" data-value="conflictos_comunidades">Conflictos con tus grupos de inter√©s (comunidades, municipios, ong's)</div>
                            </div>
                        </div>
                        <div class="ranking-column">
                            <h3>Tu Ranking</h3>
                            <div class="ranking-target">
                                <div class="target-slot"><span class="rank-number">1¬∫</span></div>
                                <div class="target-slot"><span class="rank-number">2¬∫</span></div>
                                <div class="target-slot"><span class="rank-number">3¬∫</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="error-message">Por favor, selecciona 3 desaf√≠os.</div>
                </div>

                <div class="question" data-question-id="q6">
                    <div class="question-label">6. Respecto a los 3 desaf√≠os principales que seleccionaste, ¬øpodr√≠as describir brevemente por qu√© son tan complejos para tu operaci√≥n?</div>
                    <div class="question-type">Pregunta abierta, campo de texto</div>
                    <textarea class="text-input" name="q6" rows="3" placeholder="Ej: 'La falta de personal cualificado (1) nos retrasa las obras, y el alza de precios (2) nos obliga a renegociar contratos constantemente...'"></textarea>
                    <div class="error-message">Por favor, completa este campo.</div>
                </div>
            </div>

            <!-- BLOQUE 3: FUTURO -->
            <div class="block" id="block3">
                 <div class="block-header">
                    <div class="block-title">Bloque 3: Mirando Hacia Adelante - Riesgos y Oportunidades</div>
                    <div class="block-subtitle">Duraci√≥n estimada: 2-3 minutos</div>
                </div>

                <div class="question" data-question-id="q7">
                    <div class="question-label">7. Pensando en los pr√≥ximos 2 a√±os, selecciona las 3 tendencias del entorno con mayor impacto para empresas como la tuya.</div>
                    <div class="question-type">Pregunta de Ranking (selecciona y luego arrastra para ordenar)</div>
                     <div class="ranking-wrapper" id="ranking_q7">
                        <div class="ranking-column">
                            <h3>Opciones Disponibles</h3>
                            <div class="ranking-source">
                                <div class="option" data-value="inestabilidad_economica">La inestabilidad econ√≥mica y el acceso a financiamiento</div>
                                <div class="option" data-value="exigencias_normativas">Las nuevas exigencias normativas y medioambientales</div>
                                <div class="option" data-value="digitalizacion">La capacidad de digitalizar e industrializar los procesos</div>
                                <div class="option" data-value="competencia_margenes">La competencia y la presi√≥n sobre los m√°rgenes</div>
                                <div class="option" data-value="fidelizar_talento">La capacidad para atraer y fidelizar al mejor talento</div>
                                <div class="option" data-value="costo_mano_obra">Alza del costo de la mano de obra</div>
                            </div>
                        </div>
                        <div class="ranking-column">
                            <h3>Tu Ranking</h3>
                            <div class="ranking-target">
                                <div class="target-slot"><span class="rank-number">1¬∫</span></div>
                                <div class="target-slot"><span class="rank-number">2¬∫</span></div>
                                <div class="target-slot"><span class="rank-number">3¬∫</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="error-message">Por favor, selecciona 3 tendencias.</div>
                </div>

                <div class="question" data-question-id="q8">
                    <div class="question-label">8. Sobre la tendencia que marcaste como #1, ¬øla ves principalmente como un RIESGO (que podr√≠a llevar al fracaso) o como una OPORTUNIDAD (que podr√≠a impulsar el √©xito) para tu empresa? ¬øPor qu√©?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q8" rows="3" placeholder="Escribe aqu√≠ tu respuesta..."></textarea>
                    <div class="error-message">Por favor, completa este campo.</div>
                </div>

                <div class="question" data-question-id="q9">
                    <div class="question-label">9. A pesar de los desaf√≠os, siempre hay oportunidades. ¬øD√≥nde ves t√∫ la veta m√°s clara para que tu empresa crezca o se diferencie en el futuro cercano?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q9" rows="3" placeholder="Escribe aqu√≠ tu respuesta..."></textarea>
                    <div class="error-message">Por favor, completa este campo.</div>
                </div>
            </div>

            <!-- BLOQUE 4: INTERESES -->
            <div class="block" id="block4">
                 <div class="block-header">
                    <div class="block-title">Bloque 4: Focos de Inter√©s y Visi√≥n Final</div>
                    <div class="block-subtitle">Duraci√≥n estimada: 3-4 minutos</div>
                </div>

                <div class="question" data-question-id="q10">
                    <div class="question-label">10. Para potenciar tu empresa, nos interesa saber en qu√© √°reas te gustar√≠a adquirir nuevas herramientas o conocimientos. Marca todas las que te parezcan relevantes.</div>
                    <div class="question-type">Pregunta de selecci√≥n m√∫ltiple</div>
                    <div class="options">
                        <label class="option"><input type="checkbox" name="q10" value="estrategia"><span>Estrategia de Negocio y Nuevas Oportunidades de Mercado</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="finanzas"><span>Gesti√≥n Financiera (control de costos, flujo de caja, financiamiento)</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="liderazgo"><span>Liderazgo y Gesti√≥n de Equipos</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="trabajadores"><span>Encontrar y Mantener Buenos Trabajadores</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="capacitacion"><span>Capacitaci√≥n del Personal (oficios, nuevas t√©cnicas, certificaciones)</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="clima"><span>Clima Laboral y Motivaci√≥n del Equipo</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="seguridad"><span>Prevenci√≥n de Accidentes y Seguridad</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="tecnologia"><span>Tecnolog√≠a para Mejorar el Trabajo (software, herramientas digitales)</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="negociacion"><span>Negociaci√≥n con Clientes y Manejo de Contratos</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="proveedores"><span>Problemas con Proveedores y Materiales (disponibilidad, precios, calidad)</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="ambiente"><span>Temas Ambientales (residuos, permisos, eficiencia)</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="diferenciacion"><span>Diferenciarse de la Competencia (qu√© nos hace √∫nicos)</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="normativas"><span>Cumplir con Normativas y Fiscalizaciones</span></label>
                        <label class="option"><input type="checkbox" name="q10" value="grupos_interes"><span>Relaci√≥n con grupos de inter√©s (comunidades, municipios, ong's)</span></label>
                    </div>
                    <div class="error-message">Por favor, selecciona al menos una √°rea.</div>
                </div>

                <div class="question" data-question-id="q11">
                    <div class="question-label">11. De todas las que marcaste, si tuvieras que elegir UNA SOLA √°rea para un taller pr√°ctico el pr√≥ximo mes, ¬øcu√°l ser√≠a la que te generar√≠a un impacto m√°s inmediato?</div>
                    <div class="question-type">Pregunta de opci√≥n √∫nica (basada en respuestas anteriores)</div>
                    <div class="options" id="q11Options">
                         <p style="color: #666; font-style: italic;">Selecciona primero tus √°reas de inter√©s en la pregunta anterior.</p>
                    </div>
                    <div class="error-message">Por favor, selecciona tu √°rea prioritaria.</div>
                </div>

                <div class="question" data-question-id="q12">
                    <div class="question-label">12. Respecto a esa √°rea prioritaria que elegiste, ¬øqu√© problema espec√≠fico te gustar√≠a resolver o qu√© habilidad concreta te gustar√≠a aprender?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q12" rows="3" placeholder="Escribe aqu√≠ tu respuesta..."></textarea>
                    <div class="error-message">Por favor, completa este campo.</div>
                </div>

                <div class="question" data-question-id="q13">
                    <div class="question-label">13. ¬øHay alg√∫n otro desaf√≠o o tema importante para tu empresa que no hayamos mencionado? (Opcional)</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto (opcional)</div>
                    <textarea class="text-input" name="q13" rows="3" placeholder="Escribe aqu√≠ tu respuesta..."></textarea>
                    <!-- No hay mensaje de error porque es opcional -->
                </div>

                <div class="question" data-question-id="q14">
                    <div class="question-label">14. Por √∫ltimo, cuando escuchas 'empresa sostenible', ¬øqu√© es lo primero que te viene a la mente?</div>
                    <div class="question-type">Pregunta abierta, campo de texto corto</div>
                    <textarea class="text-input" name="q14" rows="3" placeholder="Escribe aqu√≠ tu respuesta..."></textarea>
                    <div class="error-message">Por favor, completa este campo.</div>
                </div>
            </div>

            <!-- BLOQUE 5: DATOS DE CONTACTO -->
            <div class="block" id="block5">
                <div class="block-header">
                    <div class="block-title">Bloque 5: Datos de Contacto (Obligatorio)</div>
                    <div class="block-subtitle">Tu informaci√≥n es confidencial y ser√° usada solo para esta iniciativa.</div>
                </div>

                <div class="question" data-question-id="q15">
                    <div class="question-label">15. Nombre y Apellido</div>
                    <input type="text" name="q15" class="input-field" placeholder="Ej: Juan P√©rez">
                    <div class="error-message">Por favor, ingresa tu nombre y apellido.</div>
                </div>

                <div class="question" data-question-id="q16">
                    <div class="question-label">16. RUT (Personal)</div>
                    <input type="text" name="q16" class="input-field rut-field" placeholder="Ej: 12.345.678-9" maxlength="12">
                    <div class="error-message">Por favor, ingresa un RUT v√°lido.</div>
                </div>
                
                <div class="question" data-question-id="q17">
                    <div class="question-label">17. Nombre de la Empresa</div>
                    <input type="text" name="q17" class="input-field" placeholder="Ej: Constructora El Futuro SpA">
                    <div class="error-message">Por favor, ingresa el nombre de la empresa.</div>
                </div>

                <div class="question" data-question-id="q18">
                    <div class="question-label">18. RUT de la Empresa</div>
                    <input type="text" name="q18" class="input-field rut-field" placeholder="Ej: 76.123.456-7" maxlength="12">
                    <div class="error-message">Por favor, ingresa un RUT v√°lido para la empresa.</div>
                </div>

                <div class="question" data-question-id="q19">
                    <div class="question-label">19. Correo Electr√≥nico de Contacto</div>
                    <input type="email" name="q19" class="input-field" placeholder="Ej: juan.perez@empresa.cl">
                    <div class="error-message">Por favor, ingresa un correo electr√≥nico v√°lido.</div>
                </div>
            </div>

            <!-- P√ÅGINA DE COMPLETADO -->
            <div class="block" id="completion">
                <div class="completion-message">
                    <h2>¬°Gracias por tu participaci√≥n! üéâ</h2>
                    <p>Tus respuestas son muy valiosas para nosotros. Utilizaremos esta informaci√≥n para dise√±ar talleres y cursos que respondan a las necesidades reales de los socios de la CChC.</p>
                    <br>
                    <p><strong>Te mantendremos informado sobre los pr√≥ximos talleres dise√±ados especialmente para ti.</strong></b</p>
                    <br>
                    <p style="font-size: 0.9em; color: #888;">Equipo Compromiso PRO - CChC</p>
                </div>
            </div>

            <div class="navigation">
                <button class="btn btn-secondary" id="prevBtn" onclick="previousBlock()">‚Üê Anterior</button>
                <div class="step-indicator" id="stepIndicator">Bloque 1 de 5</div>
                <button class="btn btn-primary" id="nextBtn" onclick="nextBlock()">Siguiente ‚Üí</button>
            </div>
        </div>
    </div>

    <script>
    // --- L√ìGICA DEL FORMULARIO ---

    // ============================================
    // CRON√ìMETRO INVISIBLE - INICIO
    // ============================================
    let startTime = Date.now(); // Guarda el momento en que se carga la p√°gina
    // ============================================

    // #region Estado y Configuraci√≥n
    let currentBlock = 1;
    const totalBlocks = 5;
    let draggedItem = null;
    // #endregion

    // #region Funciones de Navegaci√≥n y Progreso
    function showBlock(blockNumber) {
        // Oculta todos los bloques
        document.querySelectorAll('.block').forEach(block => block.classList.remove('active'));
        
        // Muestra el bloque correcto (o la pantalla de completado)
        if (blockNumber <= totalBlocks) {
            const currentBlockEl = document.getElementById(`block${blockNumber}`);
            if (currentBlockEl) currentBlockEl.classList.add('active');
        } else {
            document.getElementById('completion').classList.add('active');
        }
        
        // Actualiza botones, barra de progreso e indicador
        updateNavigation(blockNumber);
        updateProgress(blockNumber);
        updateStepIndicator(blockNumber);
        window.scrollTo(0, 0); // Sube al inicio de la p√°gina
    }

    function nextBlock() {
        if (validateCurrentBlock()) { // Solo avanza si el bloque es v√°lido
            if (currentBlock === totalBlocks) {
                submitForm(); // Si es el √∫ltimo bloque, env√≠a el formulario
            } else {
                currentBlock++;
                showBlock(currentBlock);
            }
        }
    }

    function previousBlock() {
        if (currentBlock > 1) {
            currentBlock--;
            showBlock(currentBlock);
        }
    }

    function updateNavigation(blockNumber) {
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const navContainer = document.querySelector('.navigation');

        if (blockNumber > totalBlocks) {
            // Oculta la navegaci√≥n en la pantalla de "Gracias"
            navContainer.style.display = 'none';
        } else {
            navContainer.style.display = 'flex';
            prevBtn.style.display = blockNumber > 1 ? 'block' : 'none'; // Muestra "Anterior" excepto en el bloque 1
            nextBtn.textContent = blockNumber === totalBlocks ? 'Finalizar ‚Üí' : 'Siguiente ‚Üí'; // Cambia el texto del bot√≥n
        }
    }

    function updateProgress(blockNumber) {
        const progress = Math.min(((blockNumber - 1) / totalBlocks) * 100, 100);
        document.getElementById('progressBar').style.width = progress + '%';
    }

    function updateStepIndicator(blockNumber) {
        const indicator = document.getElementById('stepIndicator');
        if (blockNumber <= totalBlocks) {
            indicator.textContent = `Bloque ${blockNumber} de ${totalBlocks}`;
        }
    }
    // #endregion

    // #region L√≥gica de Validaci√≥n
    function validateCurrentBlock() {
        let isValid = true;
        const block = document.getElementById(`block${currentBlock}`);
        if (!block) return true; // Si no encuentra el bloque, no valida

        // Limpia errores previos en este bloque
        block.querySelectorAll('.question').forEach(q => clearError(q));

        const questions = block.querySelectorAll('.question');
        questions.forEach(question => {
            const qId = question.dataset.questionId;
            if (qId === 'q13') return; // Salta la validaci√≥n para la pregunta 13 (opcional)

            let questionIsValid = true;
            
            // Valida radios
            const radio = question.querySelector('input[type="radio"]');
            if (radio) {
                questionIsValid = question.querySelector(`input[name="${radio.name}"]:checked`) !== null;
            }

            // Valida checkboxes
            const checkbox = question.querySelector('input[type="checkbox"]');
            if (checkbox) {
                const checkedCount = question.querySelectorAll(`input[name="${checkbox.name}"]:checked`).length;
                if (checkbox.name === 'q2') { // Caso especial: pregunta 2 (hasta 2 opciones)
                    questionIsValid = checkedCount > 0 && checkedCount <= 2;
                } else { // Resto de checkboxes (al menos 1)
                    questionIsValid = checkedCount > 0;
                }
            }

            // Valida inputs de texto y textareas
            const textInput = question.querySelector('.text-input, .input-field');
            if (textInput) {
                if (textInput.type === 'email') {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    questionIsValid = emailRegex.test(textInput.value);
                } else if (textInput.classList.contains('rut-field')) {
                    questionIsValid = validateRUT(textInput.value);
                } else {
                    questionIsValid = textInput.value.trim() !== '';
                }
            }

            // Valida rankings
            const rankingWrapper = question.querySelector('.ranking-wrapper');
            if (rankingWrapper) {
                const filledSlots = rankingWrapper.querySelectorAll('.target-slot.filled').length;
                questionIsValid = filledSlots === 3; // Debe tener 3 opciones seleccionadas
            }

            // Muestra el error si no es v√°lido
            if (!questionIsValid) {
                isValid = false;
                showError(question);
            }
        });
        return isValid;
    }

    function showError(questionElement) {
        questionElement.classList.add('is-invalid'); // A√±ade borde rojo
        const errorMsg = questionElement.querySelector('.error-message');
        if (errorMsg) errorMsg.style.display = 'block'; // Muestra mensaje de error
    }

    function clearError(questionElement) {
        questionElement.classList.remove('is-invalid'); // Quita borde rojo
        const errorMsg = questionElement.querySelector('.error-message');
        if (errorMsg) errorMsg.style.display = 'none'; // Oculta mensaje de error
    }
    // #endregion

    // #region L√≥gica de Ranking Mejorada (Selecci√≥n, Eliminaci√≥n, Reorden)
    function setupRankingInteraction(wrapperId) {
        const wrapper = document.getElementById(wrapperId);
        const sourceOptions = wrapper.querySelectorAll('.ranking-source .option');
        const targetContainer = wrapper.querySelector('.ranking-target');

        // 1. SELECCI√ìN DESDE LA FUENTE (Click)
        sourceOptions.forEach(option => {
            option.addEventListener('click', () => {
                if (option.classList.contains('selected')) return; // Ya est√° seleccionada
                const targetSlots = Array.from(targetContainer.querySelectorAll('.target-slot'));
                const emptySlot = targetSlots.find(s => !s.classList.contains('filled'));

                if (emptySlot) { // Si hay espacio en el ranking
                    option.classList.add('selected'); // Desactiva en la lista de origen
                    populateSlot(emptySlot, option.dataset.value, option.textContent); // A√±ade al ranking
                    clearError(wrapper.closest('.question')); // Limpia error si lo hab√≠a
                }
            });
        });

        // 2. REORDEN (DRAG & DROP) EN EL DESTINO
        targetContainer.addEventListener('dragstart', e => {
            if (e.target.classList.contains('filled')) {
                draggedItem = e.target;
                setTimeout(() => e.target.classList.add('dragging'), 0); // A√±ade clase para feedback visual
            }
        });

        targetContainer.addEventListener('dragend', e => {
            if (draggedItem) {
                draggedItem.classList.remove('dragging');
                draggedItem = null;
            }
        });
        
        targetContainer.addEventListener('dragover', e => {
            e.preventDefault();
            const targetSlot = e.target.closest('.target-slot');
            if (targetSlot && draggedItem && targetSlot !== draggedItem && targetSlot.classList.contains('filled')) {
                 // A√±ade feedback visual "over"
                 targetContainer.querySelectorAll('.target-slot').forEach(slot => slot.classList.remove('over'));
                 targetSlot.classList.add('over');
            }
        });

        targetContainer.addEventListener('dragleave', e => {
             const targetSlot = e.target.closest('.target-slot');
             if (targetSlot) {
                 targetSlot.classList.remove('over');
             }
        });

        targetContainer.addEventListener('drop', e => {
            e.preventDefault();
            targetContainer.querySelectorAll('.target-slot').forEach(slot => slot.classList.remove('over'));
            const targetSlot = e.target.closest('.target-slot');
            
            // Intercambia el contenido de los slots
            if (targetSlot && draggedItem && targetSlot !== draggedItem && targetSlot.classList.contains('filled')) {
                const draggedData = { value: draggedItem.dataset.value, text: draggedItem.querySelector('.target-content').textContent };
                const targetData = { value: targetSlot.dataset.value, text: targetSlot.querySelector('.target-content').textContent };

                populateSlot(draggedItem, targetData.value, targetData.text);
                populateSlot(targetSlot, draggedData.value, draggedData.text);
            }
        });
    }
    
    // Funci√≥n para llenar un slot del ranking
    function populateSlot(slot, value, text) {
        slot.classList.add('filled');
        slot.dataset.value = value;
        slot.setAttribute('draggable', true);
        slot.innerHTML = `
            <span class="rank-number">${slot.querySelector('.rank-number').innerHTML}</span>
            <span class="target-content">${text}</span>
            <button type="button" class="remove-btn" aria-label="Eliminar opci√≥n">√ó</button>
        `;
        
        // 3. ELIMINACI√ìN DESDE EL DESTINO (Click en 'X')
        slot.querySelector('.remove-btn').addEventListener('click', () => {
            const sourceOption = document.querySelector(`.ranking-source .option[data-value="${value}"]`);
            if (sourceOption) sourceOption.classList.remove('selected'); // Reactiva en la lista de origen
            clearSlot(slot); // Limpia el slot
        });
    }

    // Funci√≥n para vaciar un slot del ranking
    function clearSlot(slot) {
        slot.classList.remove('filled');
        slot.removeAttribute('draggable');
        delete slot.dataset.value;
        const rankNumberHTML = `<span class="rank-number">${slot.querySelector('.rank-number').innerHTML}</span>`;
        slot.innerHTML = rankNumberHTML;
    }
    // #endregion

    // #region L√≥gica de Preguntas Din√°micas (Q11)
    function setupDynamicQ11() {
        const q10Checkboxes = document.querySelectorAll('input[name="q10"]');
        const q11OptionsContainer = document.getElementById('q11Options');
        
        const updateQ11Options = () => {
            // Guarda la selecci√≥n actual para no perderla
            const currentSelection = q11OptionsContainer.querySelector('input[name="q11"]:checked');
            const savedValue = currentSelection ? currentSelection.value : null;
            
            q11OptionsContainer.innerHTML = ''; // Limpia las opciones
            const selectedOptions = document.querySelectorAll('input[name="q10"]:checked');
            
            if (selectedOptions.length === 0) {
                q11OptionsContainer.innerHTML = `<p style="color: #666; font-style: italic;">Selecciona primero tus √°reas de inter√©s en la pregunta anterior.</p>`;
                return;
            }
            
            // Vuelve a crear las opciones solo con las seleccionadas
            selectedOptions.forEach(option => {
                const label = option.parentElement.querySelector('span').textContent;
                const isChecked = option.value === savedValue ? 'checked' : '';
                const optionHtml = `<label class="option ${isChecked ? 'selected' : ''}"><input type="radio" name="q11" value="${option.value}" ${isChecked}><span>${label}</span></label>`;
                q11OptionsContainer.innerHTML += optionHtml;
            });
        };
        
        q10Checkboxes.forEach(checkbox => checkbox.addEventListener('change', updateQ11Options));
    }
    // #endregion

    // #region Utilidades (Formato y Validaci√≥n de RUT)
    function formatRUT(rut) {
        // Limpia el RUT de todo excepto n√∫meros y k
        let cleanRUT = rut.replace(/[^0-9kK]/g, '').toUpperCase();
        if (cleanRUT.length < 2) return cleanRUT;
        
        // Separa cuerpo y d√≠gito verificador
        let body = cleanRUT.slice(0, -1);
        let verifier = cleanRUT.slice(-1);
        
        // A√±ade puntos
        let formattedBody = "";
        for (let i = body.length - 1, j = 0; i >= 0; i--, j++) {
            if (j > 0 && j % 3 === 0) formattedBody = "." + formattedBody;
            formattedBody = body[i] + formattedBody;
        }
        
        return `${formattedBody}-${verifier}`;
    }

    function validateRUT(rut) {
        // Formato b√°sico: XX.XXX.XXX-X o XXXXXXXX-X
        if (!/^[0-9]{1,2}(\.[0-9]{3})*-[0-9kK]{1}$/.test(rut)) return false;

        // Limpia para validaci√≥n
        let cleanRUT = rut.replace(/\./g, '').replace('-', '').toUpperCase();
        let body = cleanRUT.slice(0, -1);
        let verifier = cleanRUT.slice(-1);

        // Algoritmo M√≥dulo 11
        let sum = 0, multiplier = 2;
        for (let i = body.length - 1; i >= 0; i--) {
            sum += parseInt(body[i]) * multiplier;
            multiplier = multiplier === 7 ? 2 : multiplier + 1;
        }
        let calculatedVerifier = 11 - (sum % 11);
        calculatedVerifier = calculatedVerifier === 11 ? '0' : calculatedVerifier === 10 ? 'K' : String(calculatedVerifier);

        return verifier === calculatedVerifier; // Compara el d√≠gito calculado con el ingresado
    }
    // #endregion
    
    // #region Recolecci√≥n de Datos y Env√≠o al Backend
    function collectAllResponses() {
        const data = {};

        // 1. Recolecta radios, checkboxes y textos
        document.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked, .text-input, .input-field').forEach(input => {
             if (input.type === 'checkbox') {
                if (!data[input.name]) data[input.name] = [];
                data[input.name].push(input.value); // Agrupa checkboxes en un array
            } else {
                data[input.name] = input.value; // Valor simple para radios y textos
            }
        });

        // 2. Recolecta los rankings
        document.querySelectorAll('.ranking-wrapper').forEach(wrapper => {
            const qId = wrapper.id.replace('ranking_', ''); // Obtiene el ID (ej: 'q5')
            const rankedItems = Array.from(wrapper.querySelectorAll('.target-slot.filled'))
                                    .map(slot => slot.dataset.value); // Obtiene los valores en orden
            data[qId] = rankedItems;
        });
        
        // 3. Formatea los arrays de checkboxes como un solo string (ej: "vivienda, oficinas")
        // El backend espera 'q2' y 'q10' como string, no como array.
        for (const key in data) {
            if (Array.isArray(data[key]) && key !== 'q5' && key !== 'q7') {
                data[key] = data[key].join(', ');
            }
        }

        // ============================================
        // CRON√ìMETRO INVISIBLE - C√ÅLCULO FINAL
        // ============================================
        const endTime = Date.now();
        const totalSeconds = Math.floor((endTime - startTime) / 1000);
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        data['tiempo_completado'] = `${minutes}m ${seconds}s`;
        // ============================================

        return data;
    }

    async function submitForm() {
        const nextBtn = document.getElementById('nextBtn');
        nextBtn.textContent = 'Enviando...';
        nextBtn.disabled = true;

        const responses = collectAllResponses();
        console.log("Datos a enviar:", responses); // Log para depuraci√≥n

        try {
            // ‚ö†Ô∏è REEMPLAZA ESTA URL POR LA DE TU GOOGLE APPS SCRIPT
            const response = await fetch('https://script.google.com/macros/s/AKfycbxaO7CgOUCbVEP49aWdtLKmoUB6dirvzpaRTRBXffSAvuYlhUB8SmYIMHA_RsrOTMu8Eg/exec', {
                method: 'POST',
                mode: 'no-cors', // Importante para Google Apps Script
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(responses)
            });
            
            // Con mode: 'no-cors', no podemos leer la respuesta, pero si lleg√≥ aqu√≠, se envi√≥
            currentBlock = 6; // Avanza a la p√°gina de confirmaci√≥n
            showBlock(currentBlock);

        } catch (error) {
            console.error('Error al enviar el formulario:', error);
            alert(`Hubo un error al enviar tus respuestas: ${error.message}. Por favor, int√©ntalo de nuevo.`);
            nextBtn.textContent = 'Finalizar ‚Üí';
            nextBtn.disabled = false;
        }
    }
    // #endregion

    // #region Inicializaci√≥n de Eventos (Al cargar la p√°gina)
    document.addEventListener('DOMContentLoaded', () => {
        // Inicia la l√≥gica de ranking para las dos preguntas
        setupRankingInteraction('ranking_q5');
        setupRankingInteraction('ranking_q7');
        
        // Inicia la l√≥gica de la pregunta din√°mica 11
        setupDynamicQ11();
        
        // A√±ade el autoformato de RUT a los campos correspondientes
        document.querySelectorAll('.rut-field').forEach(field => {
            field.addEventListener('input', (e) => {
                // Formatea mientras escribe
                const cursorPosition = e.target.selectionStart;
                const originalLength = e.target.value.length;
                e.target.value = formatRUT(e.target.value);
                const newLength = e.target.value.length;
                
                // Intenta mantener la posici√≥n del cursor
                if (newLength > originalLength) {
                    e.target.setSelectionRange(cursorPosition + 1, cursorPosition + 1);
                } else {
                    e.target.setSelectionRange(cursorPosition, cursorPosition);
                }
            });
        });

        // Limpia los errores de validaci√≥n al interactuar con una pregunta
        document.querySelectorAll('.question').forEach(q => {
             q.addEventListener('change', () => clearError(q)); // Para radios/checkboxes
             q.addEventListener('input', () => clearError(q)); // Para textos
        });

        // A√±ade el feedback visual 'selected' a las opciones
        document.addEventListener('change', function(e) {
            if (e.target.type === 'radio' || e.target.type === 'checkbox') {
                const option = e.target.closest('.option');
                if (e.target.type === 'radio') {
                    // Quita 'selected' de las otras opciones en el mismo grupo
                    option.parentElement.querySelectorAll('.option').forEach(s => s.classList.remove('selected'));
                }
                option.classList.toggle('selected', e.target.checked);
            }
        });
        
        // Muestra el primer bloque al cargar
        showBlock(1);
    });
    // #endregion
    </script>
</body>
</html>
